<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.messanger.dao.MessangerMapper">  
  	<!-- MessangerMapper.java랑 파일명 / 메소드명 같아야함 -->
  				<!--	타입,			 반환타입 -->
  	<select id="selectList" parameterType="map" resultType="messangerVO">
  		SELECT 
  			*
  		FROM (SELECT
  				a.*,
  				rownum rnum
  			  FROM (SELECT
  			  			msg.msg_num,
  			  		<!-- 	<![CDATA[
  			  			REPLACE(REPLACE(b.title,'<','&lt;'),'>','&gt;') title,
  			  			]]> -->
  			  			msg.msg_filename,
  			  			msg.mem_num,
  			  			m.mem_name
  			  		FROM message msg JOIN member_detail m
  			  		ON msg.mem_num = m.mem_num
				<!-- <where>
						<if test="keyword != null and keyword != ''">
							<if test="keyfield == 1">
								b.title LIKE '%' || #{keyword} || '%'
							</if>
							<if test="keyfield == 2">
								m.id LIKE '%' || #{keyword} || '%' 
								OR 
  								m.nick_name LIKE '%' || #{keyword} || '%'
							</if>
							<if test="keyfield == 3">
								b.content LIKE '%' || #{keyword} || '%'
							</if>
							<if test="keyfield == 4">
								b.title LIKE '%' || #{keyword} || '%' 
								OR 
								b.content LIKE '%' || #{keyword} || '%'
							</if>
						</if>
					</where> -->	
  			  		ORDER BY msg.msg_num DESC)a)
  			  <![CDATA[
  			  WHERE rnum >= #{start} AND rnum <= #{end}
  			  ]]>
  	</select>
  	
  	<select id="selectChatroomList" parameterType="map" resultType="chatroomVO">
  		SELECT 
		*
	FROM (SELECT
			a.*,
			rownum rnum
		  FROM (SELECT
		  			c.chatroom_num,
		  			c.chatroom_name,
		  			d.mem_name,
		  			msg.msg_sendtime
		  		FROM chatroom c JOIN message msg
		  		ON c.chatroom_num = msg.chatroom_num JOIN member_detail d ON msg.mem_num = d.mem_num 
		<!-- <where>
				<if test="keyword != null and keyword != ''">
					<if test="keyfield == 1">
						b.title LIKE '%' || #{keyword} || '%'
					</if>
					<if test="keyfield == 2">
						m.id LIKE '%' || #{keyword} || '%' 
						OR 
							m.nick_name LIKE '%' || #{keyword} || '%'
					</if>
					<if test="keyfield == 3">
						b.content LIKE '%' || #{keyword} || '%'
					</if>
				</if>
			</where> -->	
		  		ORDER BY c.chatroom_num DESC)a)
  	</select>
  	
	<select id="selectRowCount" parameterType="map" resultType="integer">
	  	SELECT COUNT(*)
	  	FROM mem_dpt dpt LEFT OUTER JOIN member_detail d
	  	ON dpt.mem_dpt_num = d.mem_dpt_num
	  	<where>
	  		<if test="keyword != null and keyword != ''">
	  			<if test="keyfield == 1">
	  				d.mem_name LIKE '%' || #{keyword} || '%'
	  			</if>
	  			<if test="keyfield == 2">
	  				dpt.mem_dpt LIKE '%' || #{keyword} || '%'
	  			</if>
	  			<if test="keyfield == 3">
	  				d.mem_email LIKE '%' || #{keyword} || '%'
	  			</if>
	  			<if test="keyfield == 4">
	  				d.mem_name LIKE '%' || #{keyword} || '%' OR 
	  				dpt.mem_dpt LIKE '%' || #{keyword} || '%' OR 
	  				d.mem_email LIKE '%' || #{keyword} || '%' 
	  			</if>
	  		</if>
	  	</where>
 	</select>

 	
  	
  	
</mapper>







